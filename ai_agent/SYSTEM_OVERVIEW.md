# ğŸ¯ AIJourney â€” Complete System Overview

## System Diagram

```
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚   User's Web Browser    â”‚
                              â”‚  http://localhost:8501  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                              â”‚
              â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Streamlit     â”‚ Add Docs                 â”‚  FastAPI Swagger   â”‚
              â”‚  Professional  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  Documentation     â”‚
              â”‚  Frontend      â”‚                  â”‚       â”‚ :8000/docs         â”‚
              â”‚ :8501          â”‚                  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚                  â”‚
              â”‚ â€¢ Sidebar      â”‚                  â”‚
              â”‚ â€¢ Query Input  â”‚                  â”‚
              â”‚ â€¢ Results Tabs â”‚                  â”‚
              â”‚ â€¢ History      â”‚                  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
                       â”‚                          â”‚
                HTTP   â”‚                          â”‚
                REST   â”‚                     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚                     â”‚  FastAPI Backend         â”‚
                       â”‚                     â”‚  Port 8000               â”‚
                       â–¼                     â”‚                          â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
                â”‚                            â”‚                  â”‚       â”‚
                â”‚   POST /agent/answer       â”‚                  â”‚       â”‚
                â”‚   (Main endpoint)          â”‚                  â”‚       â”‚
                â”‚                            â”‚                  â”‚       â”‚
                â”‚   {query, web_search}      â”‚                  â”‚       â”‚
                â”‚      â†“                     â”‚                  â”‚       â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚       â”‚
                â”‚   â”‚ Load Docs from CSV  â”‚  â”‚                  â”‚       â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚       â”‚
                â”‚                â”‚           â”‚                  â”‚       â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                  â”‚       â”‚
                â”‚   â”‚ Build Vector DB     â”‚  â”‚                  â”‚       â”‚
                â”‚   â”‚ (Chroma +           â”‚  â”‚                  â”‚       â”‚
                â”‚   â”‚  SentenceTransformer)  â”‚                  â”‚       â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                  â”‚       â”‚
                â”‚                â”‚           â”‚                  â”‚       â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚
                â”‚   â”‚ Semantic Search                       â”‚   â”‚       â”‚
                â”‚   â”‚ (Find TOP_K similar docs)             â”‚   â”‚       â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜   â”‚       â”‚
                â”‚                â”‚                       â”‚      â”‚       â”‚
                â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”   â”‚       â”‚
                â”‚   â”‚ Compute Confidence    â”‚   â”‚ Check     â”‚   â”‚       â”‚
                â”‚   â”‚ (0.0 - 1.0 scale)     â”‚   â”‚ Result    â”‚   â”‚       â”‚
                â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â”‚       â”‚
                â”‚                â”‚ confidence          â”‚        â”‚       â”‚
                â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚       â”‚
                â”‚         â”‚                  â”‚         â”‚        â”‚       â”‚
                â”‚    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚       â”‚
                â”‚    â”‚ >= 0.7?  â”‚    â”‚ < 0.7?      â”‚   â”‚        â”‚       â”‚
                â”‚    â”‚ HIGH     â”‚    â”‚ LOW         â”‚   â”‚        â”‚       â”‚
                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚       â”‚
                â”‚                           â”‚          â”‚        â”‚       â”‚
                â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”   â”‚        â”‚       â”‚
                â”‚                    â”‚ Web Search  â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚ (Optional)  â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚             â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚ SerpAPI â†’   â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚ Get snippetsâ”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚             â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚ Check       â”‚   â”‚        â”‚       â”‚
                â”‚                    â”‚ relevance   â”‚   â”‚        â”‚       â”‚
                â”‚                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â”‚        â”‚       â”‚
                â”‚                           â”‚          â”‚        â”‚       â”‚
                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”       â”‚        â”‚       â”‚
                â”‚    â”‚ Combine Contexts        â”‚       â”‚        â”‚       â”‚
                â”‚    â”‚ (Local + Web) OR Local  â”‚       â”‚        â”‚       â”‚
                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚        â”‚       â”‚
                â”‚                 â”‚                    â”‚        â”‚       â”‚
                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚       â”‚
                â”‚    â”‚ Call Ollama LLM       â”‚         â”‚        â”‚       â”‚
                â”‚    â”‚ Generate Answer       â”‚         â”‚        â”‚       â”‚
                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚       â”‚
                â”‚                 â”‚                    â”‚        â”‚       â”‚
                â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚        â”‚       â”‚
                â”‚    â”‚ Return Response:         â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚ {                        â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚   answer: str,           â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚   confidence: float,     â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚   used_web_search: bool, â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚   retrieved_chunks: []   â”‚      â”‚        â”‚       â”‚
                â”‚    â”‚ }                        â”‚      â”‚        â”‚       â”‚
                â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚        â”‚       â”‚
                â”‚                 â”‚                    â”‚        â”‚       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                                  â”‚                    â”‚                â”‚
                                  â”‚                    â”‚                â”‚
                HTTP              â”‚                    â”‚                â”‚
                Response          â”‚             Other Endpoints:        â”‚
                                  â”‚             â€¢ GET /documents        â”‚
                                  â”‚             â€¢ POST /documents       â”‚
                                  â”‚             â€¢ POST /query           â”‚
                                  â”‚             â€¢ GET /docs             â”‚
                                  â”‚                                     â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                          â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                 â”‚               â”‚
                   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”
                   â”‚ CSV File â”‚    â”‚ Ollama  â”‚    â”‚ SerpAPI    â”‚
                   â”‚ Storage  â”‚    â”‚ LLM     â”‚    â”‚ (Optional) â”‚
                   â”‚          â”‚    â”‚         â”‚    â”‚            â”‚
                   â”‚ docs.csv â”‚    â”‚ Local   â”‚    â”‚ Web Search â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ Model   â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚         â”‚
                                   â”‚ Running â”‚
                                   â”‚ locally â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Query Processing Flow (Detailed)

```
â”Œâ”€ USER QUERY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "How should we design an API gateway?"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
                  â”‚                                      â”‚
                  â–¼                                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Load Documents  â”‚              â”‚ Web Search Enabled â”‚
        â”‚ from CSV        â”‚              â”‚ (Checkbox)         â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Vectorize Query         â”‚
    â”‚ (SentenceTransformer)   â”‚
    â”‚                         â”‚
    â”‚ Query Embedding Shape:  â”‚
    â”‚ [1, 384]  â† 384 dims    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Search Vector DB                   â”‚
    â”‚ Compute Cosine Similarity          â”‚
    â”‚                                    â”‚
    â”‚ For each document:                 â”‚
    â”‚   similarity = dot(q, d) / norm    â”‚
    â”‚   distance = 1 - similarity        â”‚
    â”‚                                    â”‚
    â”‚ Results (sorted by distance):      â”‚
    â”‚ 1. Doc A: distance=0.15 âœ… (GOOD)  â”‚
    â”‚ 2. Doc B: distance=0.45 âš ï¸  (OK)   â”‚
    â”‚ 3. Doc C: distance=0.89 âŒ (POOR)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Convert to Confidence (0 - 1 scale)       â”‚
    â”‚                                           â”‚
    â”‚ Formula:                                  â”‚
    â”‚ confidence = avg([1/(1+dâ‚), 1/(1+dâ‚‚)])    â”‚
    â”‚                                           â”‚
    â”‚ Result: 0.78 (78% confident) âœ…          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ >= 0.7    â”‚     â”‚ < 0.7       â”‚
    â”‚ HIGH âœ…   â”‚     â”‚ LOW âš ï¸     â”‚
    â”‚           â”‚     â”‚             â”‚
    â”‚ Answer    â”‚     â”‚ Web Search? â”‚
    â”‚ Ready     â”‚     â”‚             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚              â”‚
            â”‚         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚ Web Enabled?  â”‚
            â”‚         â”‚               â”‚
            â”‚         â”œâ”€ YES â†’ Search â”‚
            â”‚         â”‚ (SerpAPI)     â”‚
            â”‚         â”‚               â”‚
            â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚
            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚ Web Results    â”‚
            â”‚         â”‚                â”‚
            â”‚         â”‚ Query: "..."   â”‚
            â”‚         â”‚ Results: [3]   â”‚
            â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚
            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚ Relevance Check     â”‚
            â”‚         â”‚                     â”‚
            â”‚         â”‚ Q Embedding â”€â”€â”     â”‚
            â”‚         â”‚               â”œâ†’ cos_sim
            â”‚         â”‚ Web Result â”€â”€â”€â”˜     â”‚
            â”‚         â”‚               = 0.67 âœ…
            â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚
            â”‚         â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚         â”‚ Combine:        â”‚
            â”‚         â”‚ â€¢ Local chunks  â”‚
            â”‚         â”‚ â€¢ Web snippets  â”‚
            â”‚         â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Build LLM Prompt                  â”‚
    â”‚                                   â”‚
    â”‚ "Use this context to answer:      â”‚
    â”‚  CONTEXT:                         â”‚
    â”‚  [Local doc chunks +              â”‚
    â”‚   Web snippets]                   â”‚
    â”‚  QUESTION: How design gateway?    â”‚
    â”‚  ANSWER:"                         â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Call Ollama LLM         â”‚
    â”‚ (deepseek-r1)           â”‚
    â”‚                         â”‚
    â”‚ â€¢ Model loads context   â”‚
    â”‚ â€¢ Generates response    â”‚
    â”‚ â€¢ Returns text          â”‚
    â”‚                         â”‚
    â”‚ "API Gateway should ... â”‚
    â”‚  version endpoints,     â”‚
    â”‚  maintain backward      â”‚
    â”‚  compat, ..."           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Return Response Object:          â”‚
    â”‚ {                                â”‚
    â”‚   "answer": "API Gateway...",    â”‚
    â”‚   "confidence": 0.78,            â”‚
    â”‚   "used_web_search": false,      â”‚
    â”‚   "retrieved_chunks": [          â”‚
    â”‚     "chunk 1...",                â”‚
    â”‚     "chunk 2..."                 â”‚
    â”‚   ]                              â”‚
    â”‚ }                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
         HTTP Response
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Streamlit Displays:        â”‚
    â”‚                            â”‚
    â”‚ ğŸ“ Answer Tab              â”‚
    â”‚    â†’ Full response         â”‚
    â”‚                            â”‚
    â”‚ ğŸ“š Sources Tab             â”‚
    â”‚    â†’ Retrieved chunks      â”‚
    â”‚                            â”‚
    â”‚ ğŸ“Š Details Tab             â”‚
    â”‚    â†’ Confidence: 78%       â”‚
    â”‚    â†’ Web Search: No        â”‚
    â”‚    â†’ Sources: 2            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## File Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND LAYER                         â”‚
â”‚                                                          â”‚
â”‚  streamlit_app.py                                        â”‚
â”‚  â”œâ”€ Page config & styling                                â”‚
â”‚  â”œâ”€ Session state (messages)                             â”‚
â”‚  â”œâ”€ Sidebar (document management)                        â”‚
â”‚  â”œâ”€ Main area (query interface)                          â”‚
â”‚  â””â”€ Results display (tabs)                               â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚ HTTP REST
                     â”‚ :8000
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND LAYER                          â”‚
â”‚                                                          â”‚
â”‚  server.py                                               â”‚
â”‚  â”œâ”€ FastAPI app setup                                    â”‚
â”‚  â”œâ”€ Model loading (SentenceTransformer)                  â”‚
â”‚  â”‚                                                       â”‚
â”‚  â”œâ”€ Endpoints:                                           â”‚
â”‚  â”‚  â”œâ”€ GET /documents         â”€â”€â”                        â”‚
â”‚  â”‚  â”œâ”€ POST /documents        â”€â”€â”¤â†’ storage.py            â”‚
â”‚  â”‚  â”œâ”€ POST /query            â”€â”€â”˜                        â”‚
â”‚  â”‚  â”‚                                                    â”‚
â”‚  â”‚  â””â”€ POST /agent/answer                                â”‚
â”‚  â”‚     â”œâ”€ Load docs            â”€â”€â”                       â”‚
â”‚  â”‚     â”œâ”€ Build vectordb (Chroma + embeddings)           â”‚
â”‚  â”‚     â”œâ”€ Semantic search                                â”‚
â”‚  â”‚     â”œâ”€ Compute confidence                             â”‚
â”‚  â”‚     â”œâ”€ [Optional] Web search (SerpAPI)                â”‚
â”‚  â”‚     â”œâ”€ Combine contexts                               â”‚
â”‚  â”‚     â”œâ”€ Call Ollama LLM                                â”‚
â”‚  â”‚     â””â”€ Return response                                â”‚
â”‚  â”‚                                                       â”‚
â”‚  â””â”€ Helper functions:                                    â”‚
â”‚     â”œâ”€ compute_confidence()                              â”‚
â”‚     â”œâ”€ serpapi_search()                                  â”‚
â”‚     â”œâ”€ semantic_relevance()                              â”‚
â”‚     â”œâ”€ build_vectordb_from_docs()                        â”‚
â”‚     â””â”€ ask_ollama()                                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                â”‚
          â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STORAGE LAYER           â”‚    â”‚  MODELS & SERVICES       â”‚
â”‚                          â”‚    â”‚                          â”‚
â”‚  storage.py              â”‚    â”‚  Local Components:       â”‚
â”‚  â”œâ”€ save_doc()           â”‚    â”‚  â”œâ”€ SentenceTransformer  â”‚
â”‚  â”œâ”€ load_documents()     â”‚    â”‚  â”œâ”€ Chroma VectorDB      â”‚
â”‚  â””â”€ _ensure_csv()        â”‚    â”‚  â””â”€ Ollama LLM           â”‚
â”‚                          â”‚    â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚    â”‚  External (Optional):    â”‚
â”‚  â”‚ data/             â”‚   â”‚    â”‚  â””â”€ SerpAPI Web Search   â”‚
â”‚  â”‚ â””â”€ docs.csv       â”‚   â”‚    â”‚                          â”‚
â”‚  â”‚    [id, content,  â”‚   â”‚    â”‚                          â”‚
â”‚  â”‚     created_at]   â”‚   â”‚    â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Confidence Decision Tree

```
                    â”Œâ”€ Query comes in â”€â”
                    â”‚                  â”‚
                    â–¼                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
            â”‚ Load all docs â”‚          â”‚
            â”‚ Build VectorDBâ”‚          â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                    â”‚                  â”‚
                    â–¼                  â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
            â”‚ Semantic Search     â”‚    â”‚
            â”‚ Retrieve TOP_K docs â”‚    â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                     â”‚                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”          â”‚
              â”‚ Distances:  â”‚          â”‚
              â”‚ [0.1, 0.4]  â”‚          â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚
                     â”‚                 â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚ Convert to          â”‚  â”‚
              â”‚ Confidence (0 - 1)  â”‚  â”‚
              â”‚ Avg: 0.67           â”‚  â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                     â”‚                 â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
         â”‚                          â”‚  â”‚
    â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ 0.67 >= 0.7? â”‚        â”‚ Use Web       â”‚
    â”‚              â”‚        â”‚ Search?       â”‚
    â”‚ NO âŒ        â”‚        â”‚ (Checkbox)    â”‚
    â”‚              â”‚        â”‚               â”‚
    â”‚ confidence   â”‚        â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ < threshold  â”‚        â”‚ â”‚ YES âœ…      â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚ â”‚             â”‚
           â”‚                â”‚ â”‚ Call        â”‚
           â”‚                â”‚ â”‚ SerpAPI     â”‚
           â”‚                â”‚ â”‚             â”‚
           â”‚                â”‚ â”‚ Get: [3]    â”‚
           â”‚                â”‚ â”‚ snippets    â”‚
           â”‚                â”‚ â”‚             â”‚
           â”‚                â”‚ â”‚ Relevance   â”‚
           â”‚                â”‚ â”‚ Check?      â”‚
           â”‚                â”‚ â”‚             â”‚
           â”‚                â”‚ â”œâ”€ YES â†’ Add  â”‚
           â”‚                â”‚ â”‚  to context â”‚
           â”‚                â”‚ â”‚             â”‚
           â”‚                â”‚ â””â”€ NO â†’ Skip  â”‚
           â”‚                â”‚  (not rel.)   â”‚
           â”‚                â”‚               â”‚
           â”‚ (0.67 < 0.7)   â”‚ (low conf +   â”‚
           â”‚ LOW confidence â”‚  web enabled) â”‚
           â”‚ but could be   â”‚               â”‚
           â”‚ wrong, so      â”‚               â”‚
           â”‚ no web search  â”‚               â”‚
           â”‚ triggered      â”‚               â”‚
           â”‚                â”‚               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Use Final Context:   â”‚
        â”‚ [Local docs +        â”‚
        â”‚  (optional) web]     â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Call Ollama LLM      â”‚
        â”‚ Generate Answer      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Return:              â”‚
        â”‚ {answer, confidence, â”‚
        â”‚  web_search_used,    â”‚
        â”‚  chunks}             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technology Stack Summary

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  FRONTEND STACK                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Streamlit 1.28.1       ......... UI Framework         â”‚
â”‚ â€¢ Requests 2.31.0        ......... HTTP Client          â”‚
â”‚ â€¢ Python 3.9+            ......... Language             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND STACK                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ FastAPI 0.104.1        ......... REST Framework       â”‚
â”‚ â€¢ Uvicorn 0.24.0         ......... ASGI Server          â”‚
â”‚ â€¢ Pydantic               ......... Type Validation      â”‚
â”‚ â€¢ Python 3.9+            ......... Language             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               EMBEDDINGS & VECTOR DB                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ SentenceTransformers 2.2.2 ... Local Embeddings       â”‚
â”‚ â€¢ Chroma 0.4.17              ... Vector Store           â”‚
â”‚ â€¢ LangChain 0.1.0            ... Framework              â”‚
â”‚ â€¢ PyTorch (backend)          ... Deep Learning          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   LLM & SEARCH                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Ollama                     ... Local LLM Runtime      â”‚
â”‚ â€¢ SerpAPI                    ... Web Search (Optional)  â”‚
â”‚ â€¢ LangChain Community        ... Integrations           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STORAGE & UTILITIES                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ CSV (Python stdlib)        ... Document Storage       â”‚
â”‚ â€¢ UUID (Python stdlib)       ... ID Generation          â”‚
â”‚ â€¢ urllib3                    ... HTTP Utilities         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Deployment Ready

This system is **production-ready** because it includes:

âœ… Error handling & validation  
âœ… Type hints & documentation  
âœ… Modular architecture  
âœ… Configuration management  
âœ… Session state management  
âœ… Professional UI/UX  
âœ… Comprehensive documentation  
âœ… Extensible design  
âœ… API documentation (auto-generated)  
âœ… Logging hooks ready  

---

**Next Steps: See `START_HERE.md` to begin using the system!**
